<!DOCTYPE HTML> 
<html>
  <head>
    <title>CSC 400 HW3, Fall 2012</title>
    <meta http-equiv="Content-Type"
          content="text/html; charset=UTF-8" />
    <link rev="made" href="mailto:peter.brown@converse.edu" />
    <link rel="shortcut icon" href="favicon.ico" />

	<script type="text/javascript">
function updateShotsTaken() {
//  alert("UST called, shots=" + updateShotsTaken.shots);
  if (updateShotsTaken.shots === undefined) {
      updateShotsTaken.shots = 0;
  }
  else if (updateShotsTaken.shots < 5) {
      updateShotsTaken.shots += 1;
      updateShotsTakenLabel(updateShotsTaken.shots);
  }
//  alert("UST returning, shots=" + updateShotsTaken.shots);
}

updateShotsTaken.shots = 0; // Force the initialization

function updateShotsTakenLabel(shots) {
  var elt = document.getElementById("shotsLabel");
  elt.textContent = "Shots: " + shots;
}

function shoot(score) {
  // Did the handler even get called?
//  alert("Shoot("+score+")");

  if (shoot.lastScore === undefined) {  // First time through only
      shoot.lastScore = 0;
  }

  // Quit scoring after 5 shots, 
  // and don't score the second call to the handler on the same shot
  if ((updateShotsTaken.shots < 5)
       && ((score > 0) || (shoot.lastScore === 0))) {
      updateShotsTaken();

      if (shoot.totalScore === undefined) {
          shoot.totalScore = 0;
      }
      shoot.totalScore += score;
      updateLabels(shoot.totalScore, score);
  }
  shoot.lastScore = score;

  // Otherwise, there are no more shots left
//  alert("Shots, total, score: " + updateShotsTaken.shots + ", " 
//				    + shoot.totalScore + ", " + score);
}

function updateLabels(total, score) {
  var totalLabel = document.getElementById("totalLabel");
  totalLabel.textContent = "Total score: " + total;
  var scoreLabel = document.getElementById("scoreLabel");
  scoreLabel.textContent = "This shot: " + score;
}

document.addEventListener("DOMContentLoaded", init, false);

function init() {
  var elt = document.getElementById("haybale");
  // Probably should be mouseup or click
  elt.addEventListener("mouseup", getPosition, false);
}

function getPosition(event)
{
  //alert("getPosition called");
  var x = new Number();
  var y = new Number();
  var elt = document.getElementById("haybale");

  // First, figure out where the element is on the page.
  while (!elt.offsetParent) {
    elt = elt.parentNode;
  }
  //alert("Click was at " + x + "," + y);
  while (elt) {
    x += elt.offsetLeft;
    y += elt.offsetTop;
    elt = elt.offsetParent;
  }

  // Now, use where the click is on the page to find where the click
  //   is on the element
  x = event.pageX - x;
  y = event.pageY - y;

  // Offset by the observed fudge factor
  x -= 2;
  y -= 2;

  // Display the results
  //alert("Click was at " + x + "," + y);
  if (updateShotsTaken.shots < 5) {
      drawShot(x, y, updateShotsTaken.shots);
  }
}

function drawShot(x, y, shotNum) {
  //alert("drawShot(" + x + "," + y + "," + shotNum + ")");
  var elt = document.getElementById("shot" + shotNum);
  //alert(elt);
  elt.setAttribute("stroke", "green");
  elt.setAttribute("d", "M" + x + " " + y + " m-3 -3 l6 6 m0 -6 l-6 6");
}
	</script>
  </head>

	<h3>Archery Scorer</h3>

	<div id="svgstuff">
	  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="400" width="400" style="border: solid black" onclick="shoot(0);" id="haybale">
	    <!-- Draw the target -->
   	    <circle id="white" cx="200" cy="200" r="90" stroke="black" stroke-width="1" fill="white" onclick="shoot(1);"/>
	    <circle cx="200" cy="200" r="80" stroke="black" stroke-width="1" fill="white" onclick="shoot(2);"/>
	    <circle id="black" cx="200" cy="200" r="70" stroke="black" stroke-width="1" fill="black" onclick="shoot(3);"/>
	    <circle cx="200" cy="200" r="60" stroke="grey" stroke-width="1" fill="black" onclick="shoot(4);"/>
	    <circle id="blue" cx="200" cy="200" r="50" stroke="black" stroke-width="1" fill="blue" onclick="shoot(5);"/>
	    <circle cx="200" cy="200" r="40" stroke="black" stroke-width="1" fill="blue" onclick="shoot(6);" />
	    <circle id="red" cx="200" cy="200" r="30" stroke="black" stroke-width="1" fill="red" onclick="shoot(7);" />
	    <circle cx="200" cy="200" r="20" stroke="black" stroke-width="1" fill="red" onclick="shoot(8);"/>
	    <circle id="yellow" cx="200" cy="200" r="10" stroke="black" stroke-width="1" fill="yellow" onclick="shoot(9);"/>
	    <circle cx="200" cy="200" r="5" stroke="black" stroke-width="1" fill="yellow" onclick="shoot(10);"/>

	    <text x="80" y="395" id="shotsLabel">Shots: 0</text>
	    <text x="150" y="395" id="totalLabel">Total score: 0</text>
	    <text x="250" y="395" id="scoreLabel">This shot: 0</text>

	    <!--circle cx="100" cy="100" r="40" stroke="black" stroke-width="1" fill="red" onclick="shoot(this.id);" id="red" />
	    <circle cx="100" cy="100" r="20" stroke="black" stroke-width="1" fill="yellow" onclick="shoot(this.id);" id="yellow" /-->
	    <!-- Draw a shot -->
	    <path id="shot0" d="M90 78 m-3 -3 l6 6 m0 -6 l-6 6" stroke="white" stroke-width="1" fill="none" />
	    <path id="shot1" d="M90 78 m-3 -3 l6 6 m0 -6 l-6 6" stroke="white" stroke-width="1" fill="none" />
	    <path id="shot2" d="M90 78 m-3 -3 l6 6 m0 -6 l-6 6" stroke="white" stroke-width="1" fill="none" />
	    <path id="shot3" d="M90 78 m-3 -3 l6 6 m0 -6 l-6 6" stroke="white" stroke-width="1" fill="none" />
	    <path id="shot4" d="M90 78 m-3 -3 l6 6 m0 -6 l-6 6" stroke="white" stroke-width="1" fill="none" />
	  </svg>
	</div>
	
</p></div></body></html>
